<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DGtalTools: volSegment.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesomeDGtalTools.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DGtalTools<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('volSegment_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">volSegment.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;DGtal/base/Common.h&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;DGtal/helpers/StdDefs.h&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;DGtal/topology/helpers/Surfaces.h&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;DGtal/images/ImageContainerBySTLVector.h&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;DGtal/io/readers/GenericReader.h&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;DGtal/io/writers/GenericWriter.h&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;DGtal/images/IntervalForegroundPredicate.h&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;DGtal/topology/SetOfSurfels.h&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;DGtal/topology/DigitalSurface.h&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;DGtal/topology/helpers/Surfaces.h&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;CLI11.hpp&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">using namespace </span>std;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceDGtal.html">DGtal</a>;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="keyword">typedef</span> ImageContainerBySTLVector &lt; Z3i::Domain, unsigned char &gt; Image3D;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="keyword">typedef</span> ImageContainerBySTLVector &lt; Z3i::Domain, DGtal::uint64_t &gt; Image3DI;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keyword">typedef</span> Z3i::KSpace::SurfelSet SurfelSet;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="keyword">typedef</span> SetOfSurfels&lt; Z3i::KSpace, SurfelSet &gt; MySetOfSurfels;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>std::vector&lt;unsigned int&gt; getHistoFromImage(<span class="keyword">const</span> Image3D &amp;image){</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>  <span class="keyword">const</span> Image3D::Domain &amp;imgDom = image.domain();</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  std::vector&lt;unsigned int&gt; vectHisto(UCHAR_MAX);</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  <span class="keywordflow">for</span>(Image3D::Domain::ConstIterator it=imgDom.begin(); it!= imgDom.end(); ++it){</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    vectHisto[image(*it)]++;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>  }</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>  <span class="keywordflow">return</span> vectHisto;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>}</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>getOtsuThreshold(<span class="keyword">const</span> Image3D &amp;image){</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  std::vector&lt;unsigned int&gt; histo = getHistoFromImage(image);</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> imageSize = image.domain().size();</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sumA = 0;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sumB = imageSize;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> muA=0;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> muB=0;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sumMuAll= 0;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt; histo.size();t++){</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    sumMuAll+=histo[t]*t;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>  </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> thresholdRes=0;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>  <span class="keywordtype">double</span> valMax=0.0;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt; histo.size(); t++){</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    sumA+=histo[t];</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keywordflow">if</span>(sumA==0)</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>      <span class="keywordflow">continue</span>; </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    sumB=imageSize-sumA;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">if</span>(sumB==0){</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    muA+=histo[t]*t;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    muB=sumMuAll-muA;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="keywordtype">double</span> muAr=muA/(double)sumA;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="keywordtype">double</span> muBr=muB/(double)sumB;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordtype">double</span> sigma=  (double)sumA*(<span class="keywordtype">double</span>)sumB*(muAr-muBr)*(muAr-muBr);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="keywordflow">if</span>(valMax&lt;=sigma){</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>      valMax=sigma;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>      thresholdRes=t;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>  }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  <span class="keywordflow">return</span> thresholdRes;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>}</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TImageOutput&gt;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="keywordtype">void</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>applySegmentation(TImageOutput &amp;imageResuSegmentation,  <span class="keyword">const</span> Image3D &amp;inputImage, CLI::Option *labelOpt, <span class="keywordtype">int</span> maxTh, <span class="keywordtype">int</span> minTh) {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  functors::IntervalForegroundPredicate&lt;Image3D&gt; simplePredicate ( inputImage, minTh, maxTh );</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>  SurfelAdjacency&lt; Z3i::KSpace::dimension &gt; SAdj ( <span class="keyword">true</span> );</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>  Z3i::KSpace K;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  <span class="keywordtype">bool</span> space_ok = K.init( inputImage.domain().lowerBound(), inputImage.domain().upperBound(), <span class="keyword">false</span> );</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>  <span class="keywordflow">if</span>(!space_ok){</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    trace.error() &lt;&lt; <span class="stringliteral">&quot;problem initializing 3d space&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>  }</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>  std::vector&lt; std::vector&lt;Z3i::SCell &gt; &gt; vectConnectedSCell;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  Surfaces&lt;Z3i::KSpace&gt;::extractAllConnectedSCell(vectConnectedSCell,K, SAdj, simplePredicate, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  trace.progressBar(0, vectConnectedSCell.size());</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;vectConnectedSCell.size(); i++)</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>  {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    trace.progressBar(i, vectConnectedSCell.size());</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    MySetOfSurfels  aSet(K, SAdj);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    Z3i::Point lowerPoint, upperPoint;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    Z3i::Point p1;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    Z3i::Point p2;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="keywordflow">for</span>(std::vector&lt;Z3i::SCell&gt;::const_iterator it= vectConnectedSCell.at(i).begin(); it != vectConnectedSCell.at(i).end(); ++it)</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    {</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>      aSet.surfelSet().insert(aSet.surfelSet().begin(),  *it);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> orth_dir = K.sOrthDir( *it );</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>      p1 =  K.sCoords( K.sIncident( *it, orth_dir, <span class="keyword">true</span> ) );</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>      p2 =  K.sCoords( K.sIncident( *it, orth_dir, <span class="keyword">false</span> ) );</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>      <span class="keywordflow">if</span>(p1[0] &lt; lowerPoint[0]) lowerPoint[0]= p1[0];</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>      <span class="keywordflow">if</span>(p1[1] &lt; lowerPoint[1]) lowerPoint[1]= p1[1];</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>      <span class="keywordflow">if</span>(p1[2] &lt; lowerPoint[2]) lowerPoint[2]= p1[2];</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>      </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>      <span class="keywordflow">if</span>(p1[0] &gt; upperPoint[0]) upperPoint[0]= p1[0];</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>      <span class="keywordflow">if</span>(p1[1] &gt; upperPoint[1]) upperPoint[1]= p1[1];</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>      <span class="keywordflow">if</span>(p1[2] &gt; upperPoint[2]) upperPoint[2]= p1[2];</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>      </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>      <span class="keywordflow">if</span>(p2[0] &lt; lowerPoint[0]) lowerPoint[0]= p2[0];</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>      <span class="keywordflow">if</span>(p2[1] &lt; lowerPoint[1]) lowerPoint[1]= p2[1];</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>      <span class="keywordflow">if</span>(p2[2] &lt; lowerPoint[2]) lowerPoint[2]= p2[2];</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>      </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>      <span class="keywordflow">if</span>(p2[0] &gt; upperPoint[0]) upperPoint[0]= p2[0];</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>      <span class="keywordflow">if</span>(p2[1] &gt; upperPoint[1]) upperPoint[1]= p2[1];</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>      <span class="keywordflow">if</span>(p2[2] &gt; upperPoint[2]) upperPoint[2]= p2[2];</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>      </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    }</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    Z3i::KSpace kRestr ;</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    kRestr.init( lowerPoint, upperPoint, <span class="keyword">false</span> );</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">if</span>(simplePredicate(p2)){</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>      DGtal::Surfaces&lt;Z3i::KSpace&gt;::uFillInterior( kRestr,  aSet.surfelPredicate(),</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                                                  imageResuSegmentation,</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                                                  i, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (labelOpt-&gt;count() &gt; 0){</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      DGtal::Surfaces&lt;Z3i::KSpace&gt;::uFillExterior( kRestr,  aSet.surfelPredicate(),</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                                                  imageResuSegmentation,</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                                                  i+1, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  trace.progressBar(vectConnectedSCell.size(), vectConnectedSCell.size());</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>  trace.info() &lt;&lt; std::endl;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>}</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>{</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  <span class="comment">// parse command line using CLI ----------------------------------------------</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  CLI::App app;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>  std::string inputFileName;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>  std::string outputFileName {<span class="stringliteral">&quot;result.vol&quot;</span>};</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  <span class="keywordtype">bool</span> labelBackground {<span class="keyword">false</span>};</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <span class="keywordtype">int</span> minTh {0};</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  <span class="keywordtype">int</span> maxTh {255};</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>  <span class="keywordtype">bool</span> outputTypeInt {<span class="keyword">false</span>};</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  app.description(<span class="stringliteral">&quot;Segment volumetric file from a simple threshold which can be set automatically from the otsu estimation.\n The segmentation result is given by an integer label given in the resulting image. Example:\n volSegment ${DGtal}/examples/samples/lobster.vol segmentation.vol \n&quot;</span>);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  app.add_option(<span class="stringliteral">&quot;-i,--input,1&quot;</span>, inputFileName, <span class="stringliteral">&quot;volumetric input file (.vol, .pgm, .pgm3d, .longvol).&quot;</span> )</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  -&gt;required()</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  -&gt;check(CLI::ExistingFile);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  app.add_option(<span class="stringliteral">&quot;-o,--output,2&quot;</span>, outputFileName, <span class="stringliteral">&quot;volumetric output file (.vol, .pgm, .pgm3d, .longvol)&quot;</span>);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  app.add_flag(<span class="stringliteral">&quot;--outputTypeUInt&quot;</span>, outputTypeInt, <span class="stringliteral">&quot;to specify the output image type (unsigned int) instead using the default unsigned char. If this flag is selected you have to check the output file format type (longvol, or an ITK image type if the DGtal DGTAL_WITH_ITK option is selected).&quot;</span>);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>  <span class="keyword">auto</span> labelOpt = app.add_flag(<span class="stringliteral">&quot;--labelBackground&quot;</span>,labelBackground, <span class="stringliteral">&quot;option to define a label to regions associated to object background.&quot;</span>);</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  app.add_option(<span class="stringliteral">&quot;-m,--thresholdMin&quot;</span>,minTh, <span class="stringliteral">&quot;min threshold (if not given the max threshold is computed with Otsu algorithm).&quot;</span> );</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="keyword">auto</span> maxThOpt = app.add_option(<span class="stringliteral">&quot;-M,--thresholdMax&quot;</span>, maxTh, <span class="stringliteral">&quot;max threshold&quot;</span> );</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  app.get_formatter()-&gt;column_width(40);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>  CLI11_PARSE(app, argc, argv);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>  <span class="comment">// END parse command line using CLI ----------------------------------------------</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  trace.info() &lt;&lt; <span class="stringliteral">&quot;Reading input file &quot;</span> &lt;&lt; inputFileName ;</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  Image3D inputImage = DGtal::GenericReader&lt;Image3D&gt;::import(inputFileName);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  trace.info() &lt;&lt; <span class="stringliteral">&quot; [done] &quot;</span> &lt;&lt; std::endl ;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  std::ofstream outStream;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  outStream.open(outputFileName.c_str());</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="keywordflow">if</span>(maxThOpt-&gt;count()==0){</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    maxTh = getOtsuThreshold(inputImage);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    trace.info() &lt;&lt; <span class="stringliteral">&quot;maximal threshold value not specified, using Otsu value: &quot;</span>  &lt;&lt; maxTh &lt;&lt; std::endl;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  }</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  trace.info() &lt;&lt; <span class="stringliteral">&quot;Processing image to output file &quot;</span> &lt;&lt; outputFileName &lt;&lt; std::endl;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  <span class="keywordflow">if</span> (outputTypeInt)</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    Image3DI imageResuSegmentation(inputImage.domain());</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    applySegmentation(imageResuSegmentation, inputImage, labelOpt, maxTh, minTh);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    GenericWriter&lt;Image3DI&gt;::exportFile(outputFileName, imageResuSegmentation);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>  }<span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    Image3D imageResuSegmentation(inputImage.domain());</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    applySegmentation(imageResuSegmentation, inputImage, labelOpt, maxTh, minTh);</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    GenericWriter&lt;Image3D&gt;::exportFile(outputFileName, imageResuSegmentation);</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>  }</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>}</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="ttc" id="anamespaceDGtal_html"><div class="ttname"><a href="namespaceDGtal.html">DGtal</a></div><div class="ttdef"><b>Definition</b> <a href="ATu0v1_8h_source.html#l00056">ATu0v1.h:57</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_b145db2560fed4586389316a9c647f44.html">volumetric</a></li><li class="navelem"><b>volSegment.cpp</b></li>
    <li class="footer">Generated on Tue Dec 16 2025 11:49:02 for DGtalTools by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
